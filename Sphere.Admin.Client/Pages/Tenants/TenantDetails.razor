@page "/tenants/{tenantId:int}"
@inject ApiService ApiService
@inject NotificationService NotificationService
@inject NavigationManager Navigation
@inject IDialogService DialogService

<PageTitle>@(_tenant?.Name ?? "Empresa") - Sphere Admin</PageTitle>

@if (_isLoading)
{
    <MudContainer MaxWidth="MaxWidth.False" Class="d-flex justify-center align-center" Style="min-height: 400px;">
        <div class="text-center">
            <MudProgressCircular Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.h6" Class="mt-4">Cargando información de la empresa...</MudText>
        </div>
    </MudContainer>
}
else if (_tenant == null)
{
    <MudContainer MaxWidth="MaxWidth.False" Class="d-flex justify-center align-center" Style="min-height: 400px;">
        <MudCard Class="pa-8">
            <MudCardContent Class="text-center">
                <MudIcon Icon="@Icons.Material.Filled.Error" 
                       Color="Color.Error" 
                       Size="Size.Large" 
                       Class="mb-4" />
                <MudText Typo="Typo.h5" Class="mb-4">Empresa no encontrada</MudText>
                <MudButton Variant="Variant.Filled" 
                         Color="Color.Primary" 
                         Href="/tenants"
                         StartIcon="@Icons.Material.Filled.ArrowBack">
                    Volver a la lista
                </MudButton>
            </MudCardContent>
        </MudCard>
    </MudContainer>
}
else
{
    <!-- Header -->
    <MudContainer MaxWidth="MaxWidth.False" Class="mb-4">
        <div class="d-flex justify-space-between align-center">
            <div class="d-flex align-center">
                <MudIconButton Icon="@Icons.Material.Filled.ArrowBack" 
                             Color="Color.Primary" 
                             Href="/tenants"
                             Class="mr-3" />
                <MudAvatar Size="Size.Large" Color="Color.Primary" Class="mr-4">
                    @_tenant.Name.Substring(0, 1).ToUpper()
                </MudAvatar>
                <div>
                    <MudText Typo="Typo.h4" Class="mud-text-primary font-weight-bold">
                        @_tenant.Name
                    </MudText>
                    <div class="d-flex align-center gap-2">
                        <MudChip T="string" Size="Size.Small" 
                               Color="@(_tenant.Active ? Color.Success : Color.Error)">
                            @(_tenant.Active ? "Activa" : "Inactiva")
                        </MudChip>
                        <MudChip T="string" Size="Size.Small" 
                               Color="@GetLicenseColor(_tenant.LicenseType)">
                            @_tenant.LicenseType
                        </MudChip>
                        <MudText Typo="Typo.caption" Class="mud-text-secondary">
                            Código: @_tenant.Code
                        </MudText>
                    </div>
                </div>
            </div>
            <div class="d-flex gap-2">
                <MudButton Variant="Variant.Outlined" 
                         Color="Color.Primary" 
                         StartIcon="@Icons.Material.Filled.Edit"
                         Href="@($"/tenants/edit/{TenantId}")">
                    Editar
                </MudButton>
                <MudButton Variant="Variant.Filled" 
                         Color="@(_tenant.Active ? Color.Error : Color.Success)"
                         StartIcon="@(_tenant.Active ? Icons.Material.Filled.Block : Icons.Material.Filled.CheckCircle)"
                         OnClick="ToggleTenantStatus">
                    @(_tenant.Active ? "Desactivar" : "Activar")
                </MudButton>
            </div>
        </div>
    </MudContainer>

    <!-- Tabs -->
    <MudContainer MaxWidth="MaxWidth.False">
        <MudTabs Elevation="4" Rounded="true" Centered="true" Color="Color.Primary">
            
            <!-- Tab: Información General -->
            <MudTabPanel Text="Información General" Icon="@Icons.Material.Filled.Info">
                <MudGrid Class="mt-4">
                    <!-- Información Básica -->
                    <MudItem xs="12" md="6">
                        <MudCard Elevation="2" Class="full-height">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">
                                        <MudIcon Icon="@Icons.Material.Filled.Business" Class="mr-2" />
                                        Información Básica
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <div class="d-flex flex-column gap-3">
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Nombre</MudText>
                                        <MudText Typo="Typo.body1" Class="font-weight-bold">@_tenant.Name</MudText>
                                    </div>
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Código</MudText>
                                        <MudText Typo="Typo.body1" Class="font-weight-bold">@_tenant.Code</MudText>
                                    </div>
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Email de Contacto</MudText>
                                        <MudLink Href="@($"mailto:{_tenant.ContactEmail}")" Class="font-weight-bold">
                                            @_tenant.ContactEmail
                                        </MudLink>
                                    </div>
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Fecha de Registro</MudText>
                                        <MudText Typo="Typo.body1" Class="font-weight-bold">
                                            @_tenant.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                        </MudText>
                                    </div>
                                </div>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <!-- Información de Licencia -->
                    <MudItem xs="12" md="6">
                        <MudCard Elevation="2" Class="full-height">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">
                                        <MudIcon Icon="@Icons.Material.Filled.VerifiedUser" Class="mr-2" />
                                        Licencia
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <div class="d-flex flex-column gap-3">
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Tipo de Plan</MudText>
                                        <div class="d-flex align-center">
                                            <MudIcon Icon="@GetLicenseIcon(_tenant.LicenseType)" 
                                                   Color="@GetLicenseColor(_tenant.LicenseType)" 
                                                   Class="mr-2" />
                                            <MudText Typo="Typo.body1" Class="font-weight-bold">
                                                @_tenant.LicenseType
                                            </MudText>
                                        </div>
                                    </div>
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Límite de Empleados</MudText>
                                        <MudText Typo="Typo.body1" Class="font-weight-bold">
                                            0 / @_tenant.MaxEmployees empleados
                                        </MudText>
                                        <MudProgressLinear Value="@GetEmployeeUsagePercentage()" 
                                                         Color="@GetUsageColor()" 
                                                         Size="Size.Small" 
                                                         Class="mt-1" />
                                    </div>
                                    @if (_tenant.ExpiresAt.HasValue)
                                    {
                                        <div>
                                            <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Fecha de Expiración</MudText>
                                            <MudText Typo="Typo.body1" Class="@GetExpirationTextColor()">
                                                @_tenant.ExpiresAt.Value.ToString("dd/MM/yyyy")
                                                @if (_tenant.ExpiresAt.Value < DateTime.Now)
                                                {
                                                    <MudChip T="string" Size="Size.Small" Color="Color.Error" Class="ml-2">Expirada</MudChip>
                                                }
                                                else if (_tenant.ExpiresAt.Value < DateTime.Now.AddDays(7))
                                                {
                                                    <MudChip T="string" Size="Size.Small" Color="Color.Warning" Class="ml-2">Próxima a expirar</MudChip>
                                                }
                                            </MudText>
                                        </div>
                                    }
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mud-text-secondary">Estado</MudText>
                                        <MudChip T="string" Size="Size.Medium" 
                                               Color="@(_tenant.Active ? Color.Success : Color.Error)"
                                               Icon="@(_tenant.Active ? Icons.Material.Filled.CheckCircle : Icons.Material.Filled.Cancel)">
                                            @(_tenant.Active ? "Activa" : "Inactiva")
                                        </MudChip>
                                    </div>
                                </div>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <!-- Estadísticas de Uso -->
                    <MudItem xs="12">
                        <MudCard Elevation="2">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">
                                        <MudIcon Icon="@Icons.Material.Filled.Analytics" Class="mr-2" />
                                        Estadísticas de Uso
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudGrid>
                                    <MudItem xs="12" sm="6" md="3">
                                        <div class="text-center pa-4">
                                            <MudIcon Icon="@Icons.Material.Filled.People" 
                                                   Color="Color.Primary" 
                                                   Size="Size.Large" 
                                                   Class="mb-2" />
                                            <MudText Typo="Typo.h4" Class="font-weight-bold">0</MudText>
                                            <MudText Typo="Typo.body2" Class="mud-text-secondary">Empleados</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="6" md="3">
                                        <div class="text-center pa-4">
                                            <MudIcon Icon="@Icons.Material.Filled.AccessTime" 
                                                   Color="Color.Success" 
                                                   Size="Size.Large" 
                                                   Class="mb-2" />
                                            <MudText Typo="Typo.h4" Class="font-weight-bold">0</MudText>
                                            <MudText Typo="Typo.body2" Class="mud-text-secondary">Fichajes Hoy</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="6" md="3">
                                        <div class="text-center pa-4">
                                            <MudIcon Icon="@Icons.Material.Filled.Schedule" 
                                                   Color="Color.Warning" 
                                                   Size="Size.Large" 
                                                   Class="mb-2" />
                                            <MudText Typo="Typo.h4" Class="font-weight-bold">0</MudText>
                                            <MudText Typo="Typo.body2" Class="mud-text-secondary">Horas Mes</MudText>
                                        </div>
                                    </MudItem>
                                    <MudItem xs="12" sm="6" md="3">
                                        <div class="text-center pa-4">
                                            <MudIcon Icon="@Icons.Material.Filled.Login" 
                                                   Color="Color.Info" 
                                                   Size="Size.Large" 
                                                   Class="mb-2" />
                                            <MudText Typo="Typo.h4" Class="font-weight-bold">0</MudText>
                                            <MudText Typo="Typo.body2" Class="mud-text-secondary">Último Acceso</MudText>
                                        </div>
                                    </MudItem>
                                </MudGrid>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <!-- Tab: Configuración -->
            <MudTabPanel Text="Configuración" Icon="@Icons.Material.Filled.Settings">
                <MudGrid Class="mt-4">
                    <!-- Configuración de Acceso -->
                    <MudItem xs="12" md="6">
                        <MudCard Elevation="2" Class="full-height">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">
                                        <MudIcon Icon="@Icons.Material.Filled.Security" Class="mr-2" />
                                        Configuración de Acceso
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <div class="d-flex flex-column gap-4">
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mb-2">URL de la Empresa</MudText>
                                        <MudTextField Value="@GetTenantUrl()" 
                                                    ReadOnly="true" 
                                                    Variant="Variant.Outlined"
                                                    Adornment="Adornment.End"
                                                    AdornmentIcon="@Icons.Material.Filled.ContentCopy"
                                                    OnAdornmentClick="@(() => CopyToClipboard(GetTenantUrl()))"
                                                    FullWidth="true" />
                                    </div>
                                    <div>
                                        <MudText Typo="Typo.subtitle2" Class="mb-2">URL de Empleados</MudText>
                                        <MudTextField Value="@GetEmployeeUrl()" 
                                                    ReadOnly="true" 
                                                    Variant="Variant.Outlined"
                                                    Adornment="Adornment.End"
                                                    AdornmentIcon="@Icons.Material.Filled.ContentCopy"
                                                    OnAdornmentClick="@(() => CopyToClipboard(GetEmployeeUrl()))"
                                                    FullWidth="true" />
                                    </div>
                                    <MudButton Variant="Variant.Outlined" 
                                             Color="Color.Primary" 
                                             StartIcon="@Icons.Material.Filled.OpenInNew"
                                             OnClick="@(() => OpenTenantAdmin())"
                                             FullWidth="true">
                                        Abrir Panel de Admin
                                    </MudButton>
                                </div>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <!-- Base de Datos -->
                    <MudItem xs="12" md="6">
                        <MudCard Elevation="2" Class="full-height">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.h6">
                                        <MudIcon Icon="@Icons.Material.Filled.Storage" Class="mr-2" />
                                        Base de Datos
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <div class="d-flex flex-column gap-4">
                                    <div class="d-flex justify-space-between align-center">
                                        <MudText Typo="Typo.body2">Estado de la BD</MudText>
                                        <MudChip T="string" Size="Size.Small" Color="Color.Success">Conectada</MudChip>
                                    </div>
                                    <div class="d-flex justify-space-between align-center">
                                        <MudText Typo="Typo.body2">Última migración</MudText>
                                        <MudText Typo="Typo.caption" Class="mud-text-secondary">
                                            @DateTime.Now.ToString("dd/MM/yyyy")
                                        </MudText>
                                    </div>
                                    <div class="d-flex justify-space-between align-center">
                                        <MudText Typo="Typo.body2">Tamaño estimado</MudText>
                                        <MudText Typo="Typo.caption" Class="mud-text-secondary">< 1 MB</MudText>
                                    </div>
                                    <MudDivider />
                                    <div class="d-flex gap-2">
                                        <MudButton Variant="Variant.Text" 
                                                 Color="Color.Info" 
                                                 Size="Size.Small"
                                                 StartIcon="@Icons.Material.Filled.Backup">
                                            Crear Backup
                                        </MudButton>
                                        <MudButton Variant="Variant.Text" 
                                                 Color="Color.Warning" 
                                                 Size="Size.Small"
                                                 StartIcon="@Icons.Material.Filled.Update">
                                            Migrar BD
                                        </MudButton>
                                    </div>
                                </div>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <!-- Tab: Actividad -->
            <MudTabPanel Text="Actividad" Icon="@Icons.Material.Filled.Timeline">
                <div class="mt-4">
                    <MudCard Elevation="2">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6">
                                    <MudIcon Icon="@Icons.Material.Filled.History" Class="mr-2" />
                                    Actividad Reciente
                                </MudText>
                            </CardHeaderContent>
                        </MudCardHeader>
                        <MudCardContent>
                            <MudTimeline TimelinePosition="TimelinePosition.Start">
                                <MudTimelineItem Color="Color.Success" Icon="@Icons.Material.Filled.Business">
                                    <MudText Typo="Typo.body2" Class="font-weight-bold">Empresa creada</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">
                                        @_tenant.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                    </MudText>
                                </MudTimelineItem>
                                <MudTimelineItem Color="Color.Info" Icon="@Icons.Material.Filled.VerifiedUser">
                                    <MudText Typo="Typo.body2" Class="font-weight-bold">Licencia @_tenant.LicenseType asignada</MudText>
                                    <MudText Typo="Typo.caption" Class="mud-text-secondary">
                                        @_tenant.CreatedAt.ToString("dd/MM/yyyy HH:mm")
                                    </MudText>
                                </MudTimelineItem>
                                <!-- Aquí se añadirían más eventos de actividad cuando estén disponibles -->
                            </MudTimeline>
                        </MudCardContent>
                    </MudCard>
                </div>
            </MudTabPanel>

            <!-- Tab: Acciones -->
            <MudTabPanel Text="Acciones" Icon="@Icons.Material.Filled.Build">
                <div class="mt-4">
                    <MudGrid>
                        <!-- Acciones de Gestión -->
                        <MudItem xs="12" md="6">
                            <MudCard Elevation="2">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6">
                                            <MudIcon Icon="@Icons.Material.Filled.ManageAccounts" Class="mr-2" />
                                            Gestión
                                        </MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <div class="d-flex flex-column gap-3">
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Primary" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.Edit"
                                                 Href="@($"/tenants/edit/{TenantId}")">
                                            Editar Información
                                        </MudButton>
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Info" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.UpgradeSharp">
                                            Cambiar Plan
                                        </MudButton>
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Warning" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.Schedule">
                                            Extender Licencia
                                        </MudButton>
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="@(_tenant.Active ? Color.Error : Color.Success)"
                                                 FullWidth="true"
                                                 StartIcon="@(_tenant.Active ? Icons.Material.Filled.Block : Icons.Material.Filled.CheckCircle)"
                                                 OnClick="ToggleTenantStatus">
                                            @(_tenant.Active ? "Desactivar" : "Activar") Empresa
                                        </MudButton>
                                    </div>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>

                        <!-- Acciones Técnicas -->
                        <MudItem xs="12" md="6">
                            <MudCard Elevation="2">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6">
                                            <MudIcon Icon="@Icons.Material.Filled.Engineering" Class="mr-2" />
                                            Técnicas
                                        </MudText>
                                    </CardHeaderContent>
                                </MudCardHeader>
                                <MudCardContent>
                                    <div class="d-flex flex-column gap-3">
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Info" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.Backup">
                                            Crear Backup
                                        </MudButton>
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Warning" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.Update">
                                            Migrar Base de Datos
                                        </MudButton>
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Secondary" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.RestartAlt">
                                            Reiniciar Servicios
                                        </MudButton>
                                        <MudButton Variant="Variant.Outlined" 
                                                 Color="Color.Error" 
                                                 FullWidth="true"
                                                 StartIcon="@Icons.Material.Filled.DeleteForever"
                                                 OnClick="DeleteTenant">
                                            Eliminar Empresa
                                        </MudButton>
                                    </div>
                                </MudCardContent>
                            </MudCard>
                        </MudItem>
                    </MudGrid>
                </div>
            </MudTabPanel>
        </MudTabs>
    </MudContainer>
}

@code {
    [Parameter] public int TenantId { get; set; }

    private TenantDto? _tenant;
    private bool _isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadTenant();
    }

    private async Task LoadTenant()
    {
        try
        {
            _isLoading = true;
            _tenant = await ApiService.GetTenantAsync(TenantId);
        }
        catch (Exception ex)
        {
            NotificationService.ShowError("Error cargando información de la empresa");
            Console.WriteLine($"Error loading tenant: {ex.Message}");
        }
        finally
        {
            _isLoading = false;
        }
    }

    private async Task ToggleTenantStatus()
    {
        if (_tenant == null) return;

        var action = _tenant.Active ? "desactivar" : "activar";
        var confirm = await DialogService.ShowMessageBox(
            "Confirmar acción",
            $"¿Estás seguro de que quieres {action} la empresa '{_tenant.Name}'?",
            yesText: "Sí", cancelText: "Cancelar");

        if (confirm == true)
        {
            try
            {
                var updateRequest = new UpdateTenantRequest(
                    _tenant.Name,
                    _tenant.ContactEmail,
                    "", // ContactPhone
                    _tenant.LicenseType,
                    _tenant.MaxEmployees,
                    !_tenant.Active
                );

                var success = await ApiService.UpdateTenantAsync(_tenant.Id, updateRequest);
                if (success)
                {
                    NotificationService.ShowSuccess($"Empresa {action}da correctamente");
                    await LoadTenant();
                }
                else
                {
                    NotificationService.ShowError($"Error al {action} la empresa");
                }
            }
            catch (Exception ex)
            {
                NotificationService.ShowError($"Error al {action} la empresa");
                Console.WriteLine($"Error toggling tenant status: {ex.Message}");
            }
        }
    }

    private async Task DeleteTenant()
    {
        if (_tenant == null) return;

        var confirm = await DialogService.ShowMessageBox(
            "⚠️ Eliminar empresa",
            $"¿Estás seguro de que quieres eliminar la empresa '{_tenant.Name}'?\n\nEsta acción:\n• Eliminará todos los datos de la empresa\n• No se puede deshacer\n• Afectará a todos los empleados\n\nEscribe 'ELIMINAR' para confirmar:",
            yesText: "Eliminar definitivamente", cancelText: "Cancelar");

        if (confirm == true)
        {
            try
            {
                var success = await ApiService.DeleteTenantAsync(_tenant.Id);
                if (success)
                {
                    NotificationService.ShowSuccess("Empresa eliminada correctamente");
                    Navigation.NavigateTo("/tenants");
                }
                else
                {
                    NotificationService.ShowError("Error al eliminar la empresa");
                }
            }
            catch (Exception ex)
            {
                NotificationService.ShowError("Error al eliminar la empresa");
                Console.WriteLine($"Error deleting tenant: {ex.Message}");
            }
        }
    }

    private double GetEmployeeUsagePercentage()
    {
        if (_tenant == null || _tenant.MaxEmployees == 0) return 0;
        // TODO: Obtener el número real de empleados
        var currentEmployees = 0;
        return Math.Min((double)currentEmployees / _tenant.MaxEmployees * 100, 100);
    }

    private Color GetUsageColor()
    {
        var percentage = GetEmployeeUsagePercentage();
        return percentage switch
        {
            >= 90 => Color.Error,
            >= 75 => Color.Warning,
            _ => Color.Success
        };
    }

    private string GetExpirationTextColor()
    {
        if (!_tenant?.ExpiresAt.HasValue == true) return "font-weight-bold";
        
        var daysUntilExpiration = (_tenant.ExpiresAt.Value - DateTime.Now).Days;
        return daysUntilExpiration switch
        {
            < 0 => "font-weight-bold mud-error-text",
            <= 7 => "font-weight-bold mud-warning-text",
            _ => "font-weight-bold"
        };
    }

    private Color GetLicenseColor(string licenseType)
    {
        return licenseType?.ToLower() switch
        {
            "trial" => Color.Warning,
            "basic" => Color.Info,
            "professional" => Color.Primary,
            "enterprise" => Color.Secondary,
            _ => Color.Default
        };
    }

    private string GetLicenseIcon(string licenseType)
    {
        return licenseType?.ToLower() switch
        {
            "trial" => Icons.Material.Filled.Schedule,
            "basic" => Icons.Material.Filled.Star,
            "professional" => Icons.Material.Filled.StarRate,
            "enterprise" => Icons.Material.Filled.Diamond,
            _ => Icons.Material.Filled.Help
        };
    }

    private string GetTenantUrl()
    {
        return $"https://{_tenant?.Code}.tudominio.com";
    }

    private string GetEmployeeUrl()
    {
        return $"https://app.tudominio.com/{_tenant?.Code}";
    }

    private async Task CopyToClipboard(string text)
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", text);
            NotificationService.ShowSuccess("URL copiada al portapapeles");
        }
        catch
        {
            NotificationService.ShowWarning("No se pudo copiar la URL");
        }
    }

    private void OpenTenantAdmin()
    {
        var url = GetTenantUrl();
        JSRuntime.InvokeVoidAsync("open", url, "_blank");
    }
}