@inject NavigationManager Navigation
@inject AuthService AuthService

<MudNavMenu>
    <div class="d-flex flex-column align-center py-4">
        <MudAvatar Color="Color.Primary" Size="Size.Large" Class="mb-2">
            <MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" Size="Size.Large" />
        </MudAvatar>
        <MudText Typo="Typo.h6" Class="mud-text-primary font-weight-bold">
            SPHERE
        </MudText>
        <MudText Typo="Typo.caption" Class="mud-text-secondary">
            Control Admin
        </MudText>
    </div>

    <MudDivider Class="my-3" />

    <!-- Dashboard -->
    <MudNavLink Href="/" 
                Match="NavLinkMatch.All"
                Icon="@Icons.Material.Filled.Dashboard">
        Dashboard
    </MudNavLink>

    <!-- Tenants/Empresas -->
    <MudNavGroup Title="Empresas" 
                 Icon="@Icons.Material.Filled.Business"
                 Expanded="@IsExpanded("tenants")">
        <MudNavLink Href="/tenants" 
                    Icon="@Icons.Material.Filled.List">
            Lista de Empresas
        </MudNavLink>
        <MudNavLink Href="/tenants/create" 
                    Icon="@Icons.Material.Filled.Add">
            Nueva Empresa
        </MudNavLink>
    </MudNavGroup>

    <!-- Licencias -->
    <MudNavGroup Title="Licencias" 
                 Icon="@Icons.Material.Filled.VerifiedUser"
                 Expanded="@IsExpanded("licenses")">
        <MudNavLink Href="/licenses" 
                    Icon="@Icons.Material.Filled.VerifiedUser">
            Gestión Licencias
        </MudNavLink>
        <MudNavLink Href="/licenses/config" 
                    Icon="@Icons.Material.Filled.Settings">
            Configurar Planes
        </MudNavLink>
    </MudNavGroup>

    <!-- Facturación -->
    <MudNavGroup Title="Facturación" 
                 Icon="@Icons.Material.Filled.Payment"
                 Expanded="@IsExpanded("billing")">
        <MudNavLink Href="/billing" 
                    Icon="@Icons.Material.Filled.Dashboard">
            Dashboard Facturación
        </MudNavLink>
        <MudNavLink Href="/billing/invoices" 
                    Icon="@Icons.Material.Filled.Receipt">
            Facturas
        </MudNavLink>
    </MudNavGroup>

    <!-- Analytics -->
    <MudNavGroup Title="Estadísticas" 
                 Icon="@Icons.Material.Filled.Analytics"
                 Expanded="@IsExpanded("analytics")">
        <MudNavLink Href="/analytics" 
                    Icon="@Icons.Material.Filled.TrendingUp">
            Estadísticas Globales
        </MudNavLink>
        <MudNavLink Href="/analytics/usage" 
                    Icon="@Icons.Material.Filled.BarChart">
            Reportes de Uso
        </MudNavLink>
    </MudNavGroup>

    <!-- Sistema -->
    <MudNavGroup Title="Sistema" 
                 Icon="@Icons.Material.Filled.AdminPanelSettings"
                 Expanded="@IsExpanded("system")">
        <MudNavLink Href="/system/settings" 
                    Icon="@Icons.Material.Filled.Settings">
            Configuración
        </MudNavLink>
        <MudNavLink Href="/system/logs" 
                    Icon="@Icons.Material.Filled.Assignment">
            Logs del Sistema
        </MudNavLink>
        <MudNavLink Href="/system/backups" 
                    Icon="@Icons.Material.Filled.Backup">
            Respaldos
        </MudNavLink>
    </MudNavGroup>

    <MudDivider Class="my-4" />

    <!-- Usuario -->
    <MudNavGroup Title="Mi Cuenta" 
                 Icon="@Icons.Material.Filled.AccountCircle"
                 Expanded="@IsExpanded("account")">
        <MudNavLink Href="/profile" 
                    Icon="@Icons.Material.Filled.Person">
            Mi Perfil
        </MudNavLink>
        <MudNavLink Href="/profile/security" 
                    Icon="@Icons.Material.Filled.Security">
            Seguridad
        </MudNavLink>
    </MudNavGroup>

    <!-- Logout -->
    <MudNavLink OnClick="HandleLogout"
                Icon="@Icons.Material.Filled.Logout"
                Class="mud-error-text">
        Cerrar Sesión
    </MudNavLink>
</MudNavMenu>

@code {
    private bool IsExpanded(string section)
    {
        var currentPath = Navigation.Uri;
        return currentPath.Contains($"/{section}");
    }

    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        Navigation.NavigateTo("/login");
    }
}